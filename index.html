<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Timeline of Life on Earth - Pizza of Life</title>
  <link rel="stylesheet" href="page_styles/index-style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
</head>

<body>
  <div class="container">
    <div class="sky">
      <div class="stars1"></div>
      <div class="stars2"></div>
    </div>

    <div class="pizza-box">
        <div class="pizza" id="pizza">
            <!-- <img src="slices/slice1.png" class="slice" style="--rotate: 0deg" />
            <img src="slices/slice2.png" class="slice" style="--rotate: 20deg" /> -->
            <canvas id="galaxyPizza"></canvas>
            <div class="slice-overlays" id="sliceOverlays"></div>
            <!-- <div class="tooltip" id="tooltip"></div> -->
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>
  </div>

  <script>

    const canvas = document.getElementById("galaxyPizza");
    const ctx = canvas.getContext("2d");
    
    const scale = window.devicePixelRatio || 1;
    canvas.width = 500 * scale;
    canvas.height = 500 * scale;
    canvas.style.width = "700px";
    canvas.style.height = "700px";
    ctx.scale(scale, scale);

    const w = 500;
    const h = 500;
    const cx = w / 2;
    const cy = h / 2;

    const numParticles = 120;
    const partRad = 180
    const maxRadius = 200;
    const particles = [];

    
    // let currentAngle = 0;
    // const sectors = [];

    const sliceAngles = [
        360-360, 360-356.82819383259914, 360-305.2863436123348, 360-277.5330396475771, 360-198.23788546255506,
        360-166.51982378854626, 360-42.02643171806167, 360-37.66519823788546, 360-32.669603524229075,
        360-18.237885462555067, 360-5.233480176211454, 360-0.023788546255506606, 360-0.0004044052863436124, 360-0.0002458149779735683, 
        360-4.202643171806168e-05
    ];

    const sliceInfo = [
        "Formation of Earth ~4.6 Ga and the Final piece of Modern Day", "Formation of Moon ~4.5 Ga", "First carbon isotopic evidence of life ~3.85 Ga", 
        "Earliest microfossil evidence of life ~3.5 Ga", "Great Oxidation Event ~ 2.5 Ga",
        "Earliest eukaryotic fossil ~2.1 Ga & First multicellular organisms ~2.1 Ga",
        "Cambrian Explosion ~ 0.53 Ga", "Plant and Fungi Colonize Land ~0.475 Ga", "Animal Colonize Land ~ 0.412 Ga", 
        "Mammals and Dinosaurs ~ 0.23 Ga", "Dinosaur Extinction ~0.066 Ga", "Homo sapiens ~0.0003 Ga",
        "Ancient Egyptian Civilization ~6.1e-0.6 Ga", "Ancient Dynastic China ~3.1e^06 Ga", "Globalization ~5.3e-07"
    ];

    for (let i = 0; i < numParticles; i++) {
        const radius = Math.random() * partRad;
        const angle = Math.random() * Math.PI * 2;
        const speed = 0.001 + Math.random() * 0.003;
        const size = 2 + Math.random();
        const colorHue = Math.floor(180 + Math.random() * 100);
        particles.push({ radius, angle, speed, size, colorHue });
    }

    function drawRadialLines() {
        let currentAngle = 0;

        for (let angle of sliceAngles) {
            const theta = (currentAngle * Math.PI) / 180;
            const x = cx + maxRadius * Math.cos(theta);
            const y = cy + maxRadius * Math.sin(theta);

            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.lineTo(x, y);
            ctx.strokeStyle = "rgba(0, 0, 0)";
            ctx.lineWidth = 4;
            ctx.stroke();

            currentAngle += angle;
        }
    }


    function drawGradientBackground() {
        const gradient = ctx.createRadialGradient(cx, cy, 0, cx, cy, maxRadius);
        gradient.addColorStop(0, "#ed5c5c");
        gradient.addColorStop(0.3, "#990877");
        gradient.addColorStop(0.6, "#3e0554");
        gradient.addColorStop(1, "#000010");

        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, w, h);
    }

    function drawParticles() {
        for (let p of particles) {
            p.angle += p.speed;

            const x = cx + p.radius * Math.cos(p.angle);
            const y = cy + p.radius * Math.sin(p.angle);

            ctx.beginPath();
            ctx.arc(x, y, p.size, 0, Math.PI * 2);
            ctx.fillStyle = `hsl(${p.colorHue}, 100%, 70%)`;
            ctx.fill();
        }
    }

    function drawSectors() {
        for (let i = 0; i < sliceAngles.length; i++) {
            const angleDeg = sliceAngles[i];
            const startRad = (currentAngle * Math.PI) / 180;
            const endRad = ((currentAngle + angleDeg) * Math.PI) / 180;

            // Draw the arc sector
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.arc(cx, cy, r, startRad, endRad);
            ctx.closePath();

            ctx.fillStyle = `rgba(255, 255, 255, 0.1)`;
            ctx.fill();

            sectors.push({ start: startRad, end: endRad, label: sliceInfo[i] });
            currentAngle += angleDeg;
        }
    }

    function animate() {
        ctx.clearRect(0, 0, w, h);
        drawGradientBackground();
        drawRadialLines();
        drawParticles();
        requestAnimationFrame(animate);
    }

    // drawSectors();
    animate();

    const tooltip = document.getElementById("tooltip");
    const overlays = document.getElementById("sliceOverlays");

    // const tooltip = document.getElementById("tooltip");

    // canvas.addEventListener("mousemove", (e) => {
    // const rect = canvas.getBoundingClientRect();
    // const x = (e.clientX - rect.left) / (rect.width / 500);
    // const y = (e.clientY - rect.top) / (rect.height / 500);

    // const dx = x - cx;
    // const dy = y - cy;
    // const dist = Math.sqrt(dx * dx + dy * dy);
    // const angle = Math.atan2(dy, dx);
    // const normAngle = (angle < 0) ? angle + 2 * Math.PI : angle;

    // if (dist > r) {
    //     tooltip.style.display = "none";
    //     return;
    // }

    // const hovered = sectors.find(sec => normAngle >= sec.start && normAngle < sec.end);
    // if (hovered) {
    //     tooltip.style.display = "block";
    //     tooltip.style.left = `${e.pageX + 10}px`;
    //     tooltip.style.top = `${e.pageY + 10}px`;
    //     tooltip.innerHTML = `<strong>${hovered.label}</strong>`;
    // } else {
    //     tooltip.style.display = "none";
    // }
    // });

    let currentAngle = 0;

    sliceAngles.forEach((angleSize, i) => {
    const start = currentAngle;
    const end = currentAngle + angleSize;

    const r1 = start * Math.PI / 180;
    const r2 = end * Math.PI / 180;

    const x1 = 50 + 50 * Math.cos(r1); // %
    const y1 = 50 + 50 * Math.sin(r1); // %
    const x2 = 50 + 50 * Math.cos(r2); // %
    const y2 = 50 + 50 * Math.sin(r2); // %

    const slice = document.createElement("div"); // Moved INSIDE
    slice.className = "slice-region";
    slice.style.position = "absolute";
    slice.style.top = "0";
    slice.style.left = "0";
    slice.style.width = "100%";
    slice.style.height = "100%";
    slice.style.clipPath = `polygon(50% 50%, ${x1}% ${y1}%, ${x2}% ${y2}%)`;
    slice.style.background = "rgba(255,255,255,0)"; // Make it hoverable

    slice.addEventListener("mousemove", (e) => {
        tooltip.style.left = `${e.pageX + 10}px`;
        tooltip.style.top = `${e.pageY + 10}px`;
        tooltip.style.display = "block";
        tooltip.innerHTML = `<strong>${sliceInfo[i]}</strong>`;
    });

    slice.addEventListener("mouseleave", () => {
        tooltip.style.display = "none";
    });

    overlays.appendChild(slice); // Moved INSIDE
    currentAngle += angleSize;
    });

  </script>
</body>
</html>
